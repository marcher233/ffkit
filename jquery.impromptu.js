/*
 * jQuery Impromptu
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 4.0.1
 * Last Modified: 03/03/2012
 * 
 * Copyright 2012 Trent Richardson
 * Dual licensed under the MIT and GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 * 
 */
(function($){$.prompt=function(j,l){$.prompt.options=$.extend({},$.prompt.defaults,l);$.prompt.currentPrefix=$.prompt.options.prefix;$.prompt.currentStateName="";var m=($.browser.msie&&$.browser.version<7);var n=$(document.body);var o=$(window);$.prompt.options.classes=$.trim($.prompt.options.classes);if($.prompt.options.classes!='')$.prompt.options.classes=' '+$.prompt.options.classes;var p='<div class="'+$.prompt.options.prefix+'box'+$.prompt.options.classes+'" id="'+$.prompt.options.prefix+'box">';if($.prompt.options.useiframe&&(($('object, applet').length>0)||m)){p+='<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+$.prompt.options.prefix+'fade" id="'+$.prompt.options.prefix+'fade"></iframe>'}else{if(m){$('select').css('visibility','hidden')}p+='<div class="'+$.prompt.options.prefix+'fade" id="'+$.prompt.options.prefix+'fade"></div>'}p+='<div class="'+$.prompt.options.prefix+'" id="'+$.prompt.options.prefix+'"><div class="'+$.prompt.options.prefix+'container"><div class="';p+=$.prompt.options.prefix+'close">X</div><div id="'+$.prompt.options.prefix+'states"></div>';p+='</div></div></div>';$.prompt.jqib=$(p).appendTo(n);$.prompt.jqi=$.prompt.jqib.children('#'+$.prompt.options.prefix);$.prompt.jqif=$.prompt.jqib.children('#'+$.prompt.options.prefix+'fade');if(j.constructor==String){j={state0:{html:j,buttons:$.prompt.options.buttons,focus:$.prompt.options.focus,submit:$.prompt.options.submit}}}var q="";$.each(j,function(a,b){b=$.extend({},$.prompt.defaults.state,b);j[a]=b;var c="";if(b.position.arrow!==null)c='<div class="'+$.prompt.options.prefix+'arrow '+$.prompt.options.prefix+'arrow'+b.position.arrow+'"></div>';q+='<div id="'+$.prompt.options.prefix+'_state_'+a+'" class="'+$.prompt.options.prefix+'_state" style="display:none;">'+c+'<div class="'+$.prompt.options.prefix+'message">'+b.html+'</div><div class="'+$.prompt.options.prefix+'buttons">';$.each(b.buttons,function(k,v){if(typeof v=='object')q+='<button name="'+$.prompt.options.prefix+'_'+a+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" id="'+$.prompt.options.prefix+'_'+a+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" value="'+v.value+'">'+v.title+'</button>';else q+='<button name="'+$.prompt.options.prefix+'_'+a+'_button'+k+'" id="'+$.prompt.options.prefix+'_'+a+'_button'+k+'" value="'+v+'">'+k+'</button>'});q+='</div></div>'});$.prompt.states=j;$.prompt.jqi.find('#'+$.prompt.options.prefix+'states').html(q).children('.'+$.prompt.options.prefix+'_state:first').css('display','block');$.prompt.jqi.find('.'+$.prompt.options.prefix+'buttons:empty').css('display','none');$.each(j,function(f,g){var h=$.prompt.jqi.find('#'+$.prompt.options.prefix+'_state_'+f);if($.prompt.currentStateName==="")$.prompt.currentStateName=f;h.bind('promptsubmit',g.submit);h.children('.'+$.prompt.options.prefix+'buttons').children('button').click(function(){var b=h.children('.'+$.prompt.options.prefix+'message');var c=g.buttons[$(this).text()];if(c==undefined){for(var i in g.buttons)if(g.buttons[i].title==$(this).text())c=g.buttons[i].value}if(typeof c=='object')c=c.value;var d={};$.each($.prompt.jqi.find('#'+$.prompt.options.prefix+'states :input').serializeArray(),function(i,a){if(d[a.name]===undefined){d[a.name]=a.value}else if(typeof d[a.name]==Array||typeof d[a.name]=='object'){d[a.name].push(a.value)}else{d[a.name]=[d[a.name],a.value]}});var e=new $.Event('promptsubmit');e.stateName=f;e.state=h;h.trigger(e,[c,b,d]);if(!e.isDefaultPrevented()){$.prompt.close(true,c,b,d)}});h.find('.'+$.prompt.options.prefix+'buttons button:eq('+g.focus+')').addClass($.prompt.options.prefix+'defaultbutton')});var r=function(){if($.prompt.options.persistent){var b=($.prompt.options.top.toString().indexOf('%')>=0?(o.height()*(parseInt($.prompt.options.top,10)/100)):parseInt($.prompt.options.top,10)),top=parseInt($.prompt.jqi.css('top').replace('px',''),10)-b;$('html,body').animate({scrollTop:top},'fast',function(){var i=0;$.prompt.jqib.addClass($.prompt.options.prefix+'warning');var a=setInterval(function(){$.prompt.jqib.toggleClass($.prompt.options.prefix+'warning');if(i++>1){clearInterval(a);$.prompt.jqib.removeClass($.prompt.options.prefix+'warning')}},100)})}else{$.prompt.close(true)}};var s=function(e){var b=(window.event)?event.keyCode:e.keyCode;if(b==27){r()}if(b==9){var c=$(':input:enabled:visible',$.prompt.jqib);var d=!e.shiftKey&&e.target==c[c.length-1];var f=e.shiftKey&&e.target==c[0];if(d||f){setTimeout(function(){if(!c)return;var a=c[f===true?c.length-1:0];if(a)a.focus()},10);return false}}};$.prompt.position();$.prompt.style();$.prompt.jqif.click(r);o.resize({animate:false},$.prompt.position);$.prompt.jqib.bind("keydown keypress",s);$.prompt.jqi.find('.'+$.prompt.options.prefix+'close').click($.prompt.close);$.prompt.jqib.bind('promptloaded',$.prompt.options.loaded);$.prompt.jqib.bind('promptclose',$.prompt.options.callback);$.prompt.jqib.bind('promptstatechanging',$.prompt.options.statechanging);$.prompt.jqib.bind('promptstatechanged',$.prompt.options.statechanged);$.prompt.jqif.fadeIn($.prompt.options.overlayspeed);$.prompt.jqi[$.prompt.options.show]($.prompt.options.promptspeed,function(){$.prompt.jqib.trigger('promptloaded')});$.prompt.jqi.find('#'+$.prompt.options.prefix+'states .'+$.prompt.options.prefix+'_state:first .'+$.prompt.options.prefix+'defaultbutton').focus();if($.prompt.options.timeout>0)setTimeout($.prompt.close,$.prompt.options.timeout);return $.prompt.jqib};$.prompt.defaults={prefix:'jqi',classes:'',buttons:{Ok:true},loaded:function(e){},submit:function(e,v,m,f){},callback:function(e,v,m,f){},statechanging:function(e,a,b){},statechanged:function(e,a){},opacity:0.6,zIndex:999,overlayspeed:'slow',promptspeed:'fast',show:'fadeIn',focus:0,useiframe:false,top:'15%',persistent:true,timeout:0,state:{html:'',buttons:{Ok:true},focus:0,position:{container:null,x:null,y:null,arrow:null},submit:function(e,v,m,f){return true}}};$.prompt.currentPrefix=$.prompt.defaults.prefix;$.prompt.currentStateName="";$.prompt.setDefaults=function(o){$.prompt.defaults=$.extend({},$.prompt.defaults,o)};$.prompt.setStateDefaults=function(o){$.prompt.defaults.state=$.extend({},$.prompt.defaults.state,o)};$.prompt.position=function(e){var a=$.fx.off,$window=$(window),bodyHeight=$(document.body).outerHeight(true),windowHeight=$(window).height(),documentHeight=$(document).height(),height=bodyHeight>windowHeight?bodyHeight:windowHeight,top=parseInt($window.scrollTop(),10)+($.prompt.options.top.toString().indexOf('%')>=0?(windowHeight*(parseInt($.prompt.options.top,10)/100)):parseInt($.prompt.options.top,10));if(e!==undefined&&e.data.animate===false)$.fx.off=true;$.prompt.jqib.css({position:"absolute",height:height,width:"100%",top:0,left:0,right:0,bottom:0});$.prompt.jqif.css({position:"absolute",height:height,width:"100%",top:0,left:0,right:0,bottom:0});if($.prompt.states[$.prompt.currentStateName].position.container!==null){var b=$.prompt.states[$.prompt.currentStateName].position,offset=$(b.container).offset();$.prompt.jqi.css({position:"absolute"});$.prompt.jqi.animate({top:offset.top+b.y,left:offset.left+b.x,marginLeft:0,width:(b.width!==undefined)?b.width:null});top=(offset.top+b.y)-($.prompt.options.top.toString().indexOf('%')>=0?(windowHeight*(parseInt($.prompt.options.top,10)/100)):parseInt($.prompt.options.top,10));$('html,body').animate({scrollTop:top},'slow','swing',function(){})}else{$.prompt.jqi.css({position:"absolute",top:top,left:'50%',marginLeft:(($.prompt.jqi.outerWidth()/2)*-1)})}if(e!==undefined&&e.data.animate===false)$.fx.off=a};$.prompt.style=function(){$.prompt.jqif.css({zIndex:$.prompt.options.zIndex,display:"none",opacity:$.prompt.options.opacity});$.prompt.jqi.css({zIndex:$.prompt.options.zIndex+1,display:"none"});$.prompt.jqib.css({zIndex:$.prompt.options.zIndex})};$.prompt.getStateContent=function(a){return $('#'+$.prompt.currentPrefix+'_state_'+a)};$.prompt.getCurrentState=function(){return $('.'+$.prompt.currentPrefix+'_state:visible')};$.prompt.getCurrentStateName=function(){var a=$.prompt.getCurrentState().attr('id');return a.replace($.prompt.currentPrefix+'_state_','')};$.prompt.goToState=function(b,c){var d=new $.Event('promptstatechanging');$.prompt.jqib.trigger(d,[$.prompt.currentStateName,b]);if(!d.isDefaultPrevented()){$.prompt.currentStateName=b;$('.'+$.prompt.currentPrefix+'_state').slideUp('slow').find('.'+$.prompt.currentPrefix+'arrow').fadeOut();$('#'+$.prompt.currentPrefix+'_state_'+b).slideDown('slow',function(){var a=$(this);a.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();a.find('.'+$.prompt.currentPrefix+'arrow').fadeIn('slow');if(typeof c=='function'){$.prompt.jqib.bind('promptstatechanged.tmp',c)}$.prompt.jqib.trigger('promptstatechanged',[b]);if(typeof c=='function'){$.prompt.jqib.unbind('promptstatechanged.tmp')}});$.prompt.position()}};$.prompt.nextState=function(a){var b=$('#'+$.prompt.currentPrefix+'_state_'+$.prompt.currentStateName).next();$.prompt.goToState(b.attr('id').replace($.prompt.currentPrefix+'_state_',''),a)};$.prompt.prevState=function(a){var b=$('#'+$.prompt.currentPrefix+'_state_'+$.prompt.currentStateName).prev();$.prompt.goToState(b.attr('id').replace($.prompt.currentPrefix+'_state_',''),a)};$.prompt.close=function(a,b,c,d){$.prompt.jqib.fadeOut('fast',function(){if(a){$.prompt.jqib.trigger('promptclose',[b,c,d])}$.prompt.jqib.remove();$('window').unbind('resize',$.prompt.position);if(($.browser.msie&&$.browser.version<7)&&!$.prompt.options.useiframe){$('select').css('visibility','visible')}})};$.fn.extend({prompt:function(a){if(a==undefined)a={};if(a.withDataAndEvents==undefined)a.withDataAndEvents=false;$.prompt($(this).clone(a.withDataAndEvents).html(),a)},promptDropIn:function(a,b){var c=$(this);if(c.css("display")=="none"){var d=c.css('top');c.css({top:$(window).scrollTop(),display:'block'}).animate({top:d},a,'swing',b)}}})})(jQuery);